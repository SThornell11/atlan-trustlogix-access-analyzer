<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TrustLogix Data Access Governance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { theme: { extend: { colors: { trustlogix: '#1a5653' } } } }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script>window.reportData = {{ tree_data | tojson | safe }};</script>
    <style>
        .tree-line { border-left: 1px solid #e5e7eb; margin-left: 0.75rem; padding-left: 0.75rem; }
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans min-h-screen flex flex-col" x-data="{ selected: null, data: window.reportData }" x-init="if(data.length > 0 && data[0].children.length > 0) selected = data[0].children[0]">

    <div style="background-color: #ffffff; border-bottom: 3px solid #6DBE4A;" class="shadow-sm sticky top-0 z-50 p-3 flex justify-between items-center">
        <div class="flex items-center gap-4">
            <img src="https://cdn.prod.website-files.com/689aca9a00606d8ac05c62da/689b795e2e53ca91d8ff157e_TrustLogix_Dark_Logo.svg" alt="TrustLogix" class="h-8" />
            <span class="text-sm font-semibold tracking-wide text-[#1a5653] uppercase border-l border-[#4a9c2e] pl-4">Data Access Governance</span>
        </div>
    </div>
    <div class="flex-grow flex gap-6 p-6 overflow-hidden">
        <!-- SIDEBAR -->
        <div class="w-1/3 bg-white rounded-xl shadow-sm border border-gray-200 flex flex-col max-h-[calc(100vh-120px)] overflow-y-auto p-4">
            <template x-for="domain in data" :key="domain.name">
                <div class="mb-6" x-data="{ domExp: true }">
                    <!-- ATLAN DOMAIN LEVEL -->
                    <div @click="domExp = !domExp" class="flex items-center gap-2 mb-2 cursor-pointer group">
                        <svg class="w-4 h-4 text-trustlogix transform transition-transform" :class="domExp ? 'rotate-90' : ''" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M9 5l7 7-7 7" stroke-width="3" /></svg>
                        <span class="font-black text-[10px] uppercase tracking-widest text-gray-400 group-hover:text-trustlogix" x-text="domain.name"></span>
                    </div>

                    <div class="tree-line" x-show="domExp">
                        <template x-for="acc in domain.children" :key="acc.name">
                            <div class="mb-4 ml-2" x-data="{ accExp: true }">
                                <!-- SNOWFLAKE ACCOUNT LEVEL (TRUSTLOGIX ACCOUNT) -->
                                <div @click="selected = acc; accExp = !accExp" class="cursor-pointer flex items-center gap-2 p-2 rounded-lg hover:bg-gray-50 border border-transparent transition-all" :class="selected === acc ? 'bg-teal-50 border-teal-100' : ''">
                                    <div class="w-6 h-6 rounded flex items-center justify-center font-black text-[10px] text-white shadow-sm" :class="(acc.subtype || '').toLowerCase().includes('snowflake') ? 'bg-blue-600' : 'bg-orange-500'">
                                        <span x-text="(acc.subtype || '').toLowerCase().includes('snowflake') ? 'S' : 'D'"></span>
                                    </div>
                                    <span class="font-bold text-sm truncate text-gray-700" x-text="acc.name"></span>
                                </div>

                                <div class="tree-line mt-2" x-show="accExp">
                                    <template x-for="sub in acc.children" :key="sub.name">
                                        <div class="mb-1" x-data="{ subExp: false }">
                                            <div @click="selected = sub; subExp = !subExp" class="cursor-pointer p-1.5 text-xs font-semibold hover:text-teal-600 flex items-center gap-2" :class="selected === sub ? 'text-teal-700 font-bold' : ''">
                                                <span x-text="sub.name"></span>
                                                <template x-if="sub.type === 'RISKS_CONTAINER' && sub.risks && sub.risks.length > 0">
                                                    <span class="bg-red-500 text-white text-[9px] px-1.5 rounded-full" x-text="sub.risks.length"></span>
                                                </template>
                                            </div>

                                            <!-- ACCESS ANALYZER TREE (DB > SCHEMA > TABLE) -->
                                            <div class="tree-line mt-1 ml-2" x-show="subExp && sub.type === 'ACCESS_CONTAINER'">
                                                <template x-for="db in sub.children" :key="db.name">
                                                    <div class="mb-1" x-data="{ dbExp: false }">
                                                        <div @click.stop="selected = db; dbExp = !dbExp" class="p-1 text-xs cursor-pointer hover:bg-gray-100 flex items-center gap-1 rounded" :class="selected === db ? 'bg-teal-50 text-teal-700 font-semibold' : ''">
                                                            <svg class="w-3 h-3 text-gray-400 transform transition-transform" :class="dbExp ? 'rotate-90' : ''" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M9 5l7 7-7 7" stroke-width="2" /></svg>
                                                            <span x-text="db.name"></span>
                                                        </div>
                                                        <div class="tree-line ml-2" x-show="dbExp">
                                                            <template x-for="sch in db.children" :key="sch.name">
                                                                <div x-data="{ schExp: false }">
                                                                    <div @click.stop="selected = sch; schExp = !schExp" class="p-1 text-[11px] cursor-pointer hover:text-teal-600 flex items-center gap-1" :class="selected === sch ? 'text-teal-700 font-semibold' : ''">
                                                                        <svg class="w-2.5 h-2.5 text-gray-300 transform transition-transform" :class="schExp ? 'rotate-90' : ''" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M9 5l7 7-7 7" stroke-width="2" /></svg>
                                                                        <span x-text="sch.name"></span>
                                                                    </div>
                                                                    <div class="tree-line ml-2" x-show="schExp">
                                                                        <template x-for="tbl in sch.children" :key="tbl.name">
                                                                            <div @click.stop="selected = tbl" class="p-1 text-[10px] text-gray-500 cursor-pointer hover:bg-green-50 rounded" :class="selected === tbl ? 'bg-green-100 text-green-800 font-bold' : ''" x-text="tbl.name"></div>
                                                                        </template>
                                                                    </div>
                                                                </div>
                                                            </template>
                                                        </div>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </template>
        </div>

        <!-- DETAILS PANEL -->
        <div class="w-2/3 bg-white rounded-xl shadow-sm border border-gray-200 p-8 overflow-y-auto min-h-[calc(100vh-120px)]">
            <template x-if="selected">
                <div class="animate-in fade-in duration-300">
                    <div class="flex justify-between items-start border-b pb-6 mb-8">
                        <div>
                            <span class="text-[10px] font-black text-gray-400 uppercase tracking-widest" x-text="selected.type"></span>
                            <h2 class="text-3xl font-black tracking-tight" x-text="selected.name"></h2>
                        </div>
                        <template x-if="selected.risks_summary">
                            <div class="flex gap-4">
                                <div class="px-4 py-2 bg-red-50 border border-red-100 rounded-lg text-center">
                                    <div class="text-red-600 font-black text-xl" x-text="selected.risks_summary.high"></div>
                                    <div class="text-[9px] font-bold text-red-400 uppercase">High</div>
                                </div>
                                <div class="px-4 py-2 bg-green-50 border border-green-100 rounded-lg text-center">
                                    <div class="text-green-600 font-black text-xl" x-text="selected.risks_summary.total"></div>
                                    <div class="text-[9px] font-bold text-green-400 uppercase">Total</div>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- RISKS VIEW -->
                    <template x-if="selected.type === 'RISKS_CONTAINER'">
                        <div class="space-y-4">
                            <template x-for="r in (selected.risks || [])">
                                <div class="p-4 border rounded-xl hover:shadow-md transition-all">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="font-black text-xs uppercase px-2 py-0.5 bg-gray-100 rounded" x-text="r.category"></span>
                                        <span class="px-2 py-0.5 rounded-full text-[9px] font-bold border border-red-200 text-red-600" x-text="r.severity"></span>
                                    </div>
                                    <div class="text-xs font-bold text-gray-800 mb-1" x-text="r.raw_name"></div>
                                    <p class="text-sm text-gray-600 leading-relaxed" x-text="r.details"></p>
                                </div>
                            </template>
                            <template x-if="!selected.risks || selected.risks.length === 0">
                                <div class="py-20 text-center flex flex-col items-center">
                                    <div class="w-16 h-16 bg-green-50 rounded-full flex items-center justify-center text-green-500 mb-4">
                                        <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke-width="2" /></svg>
                                    </div>
                                    <h3 class="font-black text-xl text-gray-900">Data Access Governance Verified</h3>
                                    <p class="text-gray-400 text-sm mt-1">No security risks detected for this environment.</p>
                                </div>
                            </template>
                        </div>
                    </template>

                    <!-- ACCESS TABLE -->
                    <template x-if="['DATABASE','SCHEMA','TABLE'].includes(selected.type)">
                        <div class="border rounded-xl overflow-hidden shadow-sm">
                            <table class="min-w-full text-xs">
                                <thead class="bg-gray-50 font-black uppercase text-gray-500 border-b">
                                    <tr><th class="px-6 py-4 text-left">Role / User</th><th class="px-6 py-4 text-left">Direct Privileges</th></tr>
                                </thead>
                                <tbody class="divide-y">
                                    <template x-for="ent in (selected.entitlements || [])">
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-4 font-bold" x-text="ent.name"></td>
                                            <td class="px-6 py-4 flex flex-wrap gap-1">
                                                <template x-for="p in ent.privileges"><span class="bg-gray-100 px-2 py-0.5 rounded border border-gray-200" x-text="p"></span></template>
                                            </td>
                                        </tr>
                                    </template>
                                    <tr x-show="!selected.entitlements || selected.entitlements.length === 0">
                                        <td colspan="2" class="px-6 py-10 text-center text-gray-400 italic">
                                            <span x-show="selected.type === 'TABLE'">No direct entitlements discovered for this table.</span>
                                            <span x-show="selected.type !== 'TABLE'">No direct entitlements at this level â€” expand to view table-level access below.</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </template>
                </div>
            </template>
        </div>
    </div>
</body>
</html>